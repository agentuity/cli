{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Agentuity Template Schema",
  "description": "Schema for Agentuity template files",
  "oneOf": [
    {
      "title": "Main Templates List",
      "description": "Schema for the main templates.yaml file",
      "type": "array",
      "items": {
        "$ref": "#/definitions/Template"
      }
    },
    {
      "title": "Language Templates List",
      "description": "Schema for language-specific templates.yaml files",
      "type": "array",
      "items": {
        "$ref": "#/definitions/ProjectTemplate"
      }
    },
    {
      "title": "Template Rules",
      "description": "Schema for rules.yaml files",
      "$ref": "#/definitions/TemplateRules"
    }
  ],
  "definitions": {
    "Template": {
      "type": "object",
      "required": ["name", "description", "identifier", "language", "requirements"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Display name of the template"
        },
        "description": {
          "type": "string",
          "description": "Description of the template"
        },
        "identifier": {
          "type": "string",
          "description": "Unique identifier for the template"
        },
        "language": {
          "type": "string",
          "description": "Programming language used by the template"
        },
        "requirements": {
          "type": "array",
          "description": "List of requirements for the template",
          "items": {
            "$ref": "#/definitions/Requirement"
          }
        }
      }
    },
    "Requirement": {
      "type": "object",
      "required": ["command", "version"],
      "properties": {
        "command": {
          "type": "string",
          "description": "Command to check for"
        },
        "args": {
          "type": "array",
          "description": "Arguments to pass to the command",
          "items": {
            "type": "string"
          }
        },
        "version": {
          "type": "string",
          "description": "Version constraint for the command"
        },
        "brew": {
          "type": "string",
          "description": "Homebrew formula to install the command"
        },
        "url": {
          "type": "string",
          "description": "URL to download the command"
        },
        "selfupdate": {
          "type": "object",
          "description": "Self-update configuration",
          "properties": {
            "command": {
              "type": "string",
              "description": "Command to run for self-update"
            },
            "args": {
              "type": "array",
              "description": "Arguments to pass to the self-update command",
              "items": {
                "type": "string"
              }
            }
          }
        }
      }
    },
    "ProjectTemplate": {
      "type": "object",
      "required": ["name", "description", "steps"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Display name of the project template"
        },
        "description": {
          "type": "string",
          "description": "Description of the project template"
        },
        "dependencies": {
          "type": "array",
          "description": "List of dependencies for the template",
          "items": {
            "type": "string"
          }
        },
        "steps": {
          "type": "array",
          "description": "List of steps to execute",
          "items": {
            "$ref": "#/definitions/Step"
          }
        }
      }
    },
    "TemplateRules": {
      "type": "object",
      "required": ["identifier", "language", "runtime", "src_dir", "filename"],
      "properties": {
        "identifier": {
          "type": "string",
          "description": "Unique identifier for the template"
        },
        "language": {
          "type": "string",
          "description": "Programming language used by the template"
        },
        "runtime": {
          "type": "string",
          "description": "Runtime for the template"
        },
        "framework": {
          "type": "string",
          "description": "Framework used by the template"
        },
        "src_dir": {
          "type": "string",
          "description": "Source directory for the template"
        },
        "filename": {
          "type": "string",
          "description": "Main filename for the template"
        },
        "bundle": {
          "type": "object",
          "description": "Bundling configuration",
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Whether bundling is enabled"
            },
            "ignore": {
              "type": "array",
              "description": "List of patterns to ignore during bundling",
              "items": {
                "type": "string"
              }
            }
          }
        },
        "development": {
          "type": "object",
          "description": "Development configuration",
          "properties": {
            "port": {
              "type": "integer",
              "description": "Port to use for development server"
            },
            "watch": {
              "type": "object",
              "description": "File watching configuration",
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "description": "Whether file watching is enabled"
                },
                "files": {
                  "type": "array",
                  "description": "List of file patterns to watch",
                  "items": {
                    "type": "string"
                  }
                }
              }
            },
            "command": {
              "type": "string",
              "description": "Command to run for development"
            },
            "args": {
              "type": "array",
              "description": "Arguments to pass to the development command",
              "items": {
                "type": "string"
              }
            }
          }
        },
        "deployment": {
          "type": "object",
          "description": "Deployment configuration",
          "properties": {
            "resources": {
              "type": "object",
              "description": "Resource requirements for deployment",
              "properties": {
                "memory": {
                  "type": "string",
                  "description": "Memory requirement"
                },
                "cpu": {
                  "type": "string",
                  "description": "CPU requirement"
                }
              }
            },
            "command": {
              "type": "string",
              "description": "Command to run for deployment"
            },
            "args": {
              "type": "array",
              "description": "Arguments to pass to the deployment command",
              "items": {
                "type": "string"
              }
            }
          }
        },
        "new_project": {
          "type": "object",
          "description": "Steps to create a new project",
          "properties": {
            "steps": {
              "type": "array",
              "description": "List of steps to execute",
              "items": {
                "$ref": "#/definitions/Step"
              }
            }
          }
        },
        "new_agent": {
          "type": "object",
          "description": "Steps to create a new agent",
          "properties": {
            "steps": {
              "type": "array",
              "description": "List of steps to execute",
              "items": {
                "$ref": "#/definitions/Step"
              }
            }
          }
        }
      }
    },
    "Step": {
      "type": "object",
      "oneOf": [
        {
          "required": ["command"],
          "properties": {
            "command": {
              "type": "string",
              "description": "Command to run"
            },
            "args": {
              "type": "array",
              "description": "Arguments to pass to the command",
              "items": {
                "type": "string"
              }
            }
          }
        },
        {
          "required": ["action"],
          "properties": {
            "action": {
              "type": "string",
              "description": "Action to perform",
              "enum": [
                "create_file",
                "delete_file",
                "modify_package_json",
                "modify_ts_config",
                "append_file",
                "copy_file",
                "copy_dir"
              ]
            },
            "filename": {
              "type": "string",
              "description": "Filename for file operations"
            },
            "content": {
              "type": "string",
              "description": "Content for file operations"
            },
            "template": {
              "type": "string",
              "description": "Template for file operations"
            },
            "from": {
              "type": "string",
              "description": "Source path for file operations"
            },
            "to": {
              "type": "string",
              "description": "Destination path for file operations"
            },
            "files": {
              "type": "array",
              "description": "List of files for file operations",
              "items": {
                "type": "string"
              }
            },
            "script": {
              "type": "array",
              "description": "Script entries for package.json modifications",
              "items": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string",
                    "description": "Script name"
                  },
                  "value": {
                    "type": "string",
                    "description": "Script value"
                  }
                }
              }
            },
            "main": {
              "type": "string",
              "description": "Main entry point for package.json"
            },
            "type": {
              "type": "string",
              "description": "Module type for package.json"
            },
            "name": {
              "type": "string",
              "description": "Package name for package.json"
            },
            "version": {
              "type": "string",
              "description": "Package version for package.json"
            },
            "description": {
              "type": "string",
              "description": "Package description for package.json"
            },
            "keywords": {
              "type": "array",
              "description": "Package keywords for package.json",
              "items": {
                "type": "string"
              }
            },
            "types": {
              "type": "array",
              "description": "Types for tsconfig.json",
              "items": {
                "type": "string"
              }
            },
            "compilerOptions": {
              "type": "array",
              "description": "Compiler options for tsconfig.json",
              "items": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string",
                    "description": "Option name"
                  },
                  "value": {
                    "type": "boolean",
                    "description": "Option value"
                  }
                }
              }
            }
          }
        }
      ]
    }
  }
}
